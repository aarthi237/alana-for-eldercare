# Rasa chatbot

To avoid library dependency issue and to use the latest version of Rasa NLU, Docker image has been used to train and run the Rasa NLU.

Following command has used to train and run the rasa

docker run -it -u 1000:1000 -v $(pwd):/app rasa/rasa:latest-full train
docker run -it --net="host" -u 1000:1000 -v $(pwd):/app rasa/rasa:latest-full shell
docker run -it --net="host" -u 1000:1000 -v $(pwd):/app rasa/rasa:latest-full run
docker run -it --net="host" -u 1000:1000 -v $(pwd):/app rasa/rasa:latest-full run actions

## Steps to Start Rasa
1. Open terminal and run rasa core and actions using following command

$docker run -it --net="host" -u 1000:1000 -v $(pwd):/app rasa/rasa:latest-full run
$docker run -it --net="host" -u 1000:1000 -v $(pwd):/app rasa/rasa:latest-full run actions

2. Go to dir event_api and run following command to start event api
$npm install
$npm run start

## Steps to Integrate with Telegram
If you want to integrate with telegram, you need to use ngrok to create http tunnelling.
1. Create account with Telegram 
2. Open telegram, and search the channel `BotFather`
	 In the chat window, type `/newbot`
	 It will ask the bot and username
	Then BotFather provides the unique token to integrate our rasa chat with Telegram.
3. Download ngrok, unzip and run following command inside ngrok directory.

$ngrok http 5005

4. Copy the url generated by ngrok and paste in the credential.yml file.
5. Also copy the Telegram generated token and chatbot name in the credential.yml file. This will be like below,

 telegram: access_token: "2423423423:AAdsgdgdgUKHUIygHUuuEqsqxWqL3IWQ"
 verify: "event_advice_bot" webhook_url:
 "https://534JHUe0.ngrok.io/webhooks/telegram/webhook"

6. Restart the rasa 
7. Search the bot name in the Telegram and start chatting.

## Integrate Rasa with Furhat

Instead of Telegram, if you want to integrate with Furhat follow the below steps.
1. Download the FurhatSDK and unzip.
2. Go to Furhat directory and run below command
	 $./launchSDK.sh

3. I am using the furhat skill from the following Github with little modifications.
[https://github.com/FurhatRobotics/example-skills](https://github.com/FurhatRobotics/example-skills)

4.Open IntelliJ and select  `Create new Project`. Select  `Kotlin`  and `JVM | IDEA`  and click Next. In Project name browse  WolframAlpha  and click Finish.
At the bottom right of the screen you should see a small window that asks if you want to impport a gradle project. Click on  `Import Gradle Project`.
Then go to `Run` > `Edit Configurations`. Then add `Kotlin` by pressing on "`+`" in the upper left corner. In the next window select `WolframAlpha.main` for "`Use classpath for module`" and then in `Main class` browse and select `furhatos.app.WolframAlpha.MainKt`. 

Note: if your laptop struggles to run all ( rasa + api + furhatsdk + furhatskill) at the same time. you can run things in different laptops.
To run the furhat skill in different laptop, add the following command in the Edit Configuration ,

`VM Options: -Dfurhatos.skills.brokeraddress=<ip-address-of-furhat>`

5. After Edit, Click the `Run` button (green triangle) and the program should start running.